<div class="formatter-container">


  <div class="editor-container">
    <!-- Input Section -->
    <div class="editor-section">
      <h3>Input JSON</h3>
      <div class="input-actions">
        <button mat-button (click)="loadSample()">
          <mat-icon>description</mat-icon>
          Load Sample
        </button>
        <button mat-button (click)="clearInput()">
          <mat-icon>clear</mat-icon>
          Clear
        </button>
      </div>
      <textarea
        class="json-input"
        [(ngModel)]="jsonInput"
        placeholder="Paste your JSON here or use the 'Load Sample' button"
        spellcheck="false"
      ></textarea>
    </div>

    <!-- Action Buttons Column -->
    <div class="actions-column">
      <div class="action-buttons">
        <button mat-raised-button color="primary" (click)="formatJson()" [disabled]="!jsonInput">
          <mat-icon>format_indent_increase</mat-icon>
          Format
        </button>
        <button mat-raised-button color="accent" (click)="minifyJson()" [disabled]="!jsonInput">
          <mat-icon>format_indent_decrease</mat-icon>
          Minify
        </button>
        <button mat-raised-button (click)="toggleView()" [disabled]="!jsonOutput" matTooltip="Toggle between Raw, Tree, and JSON Viewer">
          <mat-icon>
            <ng-container [ngSwitch]="viewMode">
              <span *ngSwitchCase="'raw'">code</span>
              <span *ngSwitchCase="'tree'">account_tree</span>
              <span *ngSwitchCase="'viewer'">visibility</span>
            </ng-container>
          </mat-icon>
          <ng-container [ngSwitch]="viewMode">
            <span *ngSwitchCase="'raw'">Tree View</span>
            <span *ngSwitchCase="'tree'">JSON Viewer</span>
            <span *ngSwitchCase="'viewer'">Raw View</span>
          </ng-container>
        </button>
        <div class="divider"></div>
        <button mat-raised-button (click)="convertToXml()" [disabled]="!jsonInput">
          <mat-icon>code</mat-icon>
          To XML
        </button>
        <button mat-raised-button (click)="convertToYaml()" [disabled]="!jsonInput">
          <mat-icon>code</mat-icon>
          To YAML
        </button>
        <button mat-raised-button (click)="convertToCsv()" [disabled]="!jsonInput">
          <mat-icon>table_chart</mat-icon>
          To CSV
        </button>
      </div>
    </div>

    <!-- Output Section -->
    <div class="editor-section">
      <h3>Formatted JSON</h3>
      <div class="output-actions">
        <button mat-button (click)="copyToClipboard()" [disabled]="!jsonOutput">
          <mat-icon>content_copy</mat-icon>
          Copy
        </button>
        <button mat-button (click)="downloadJson()" [disabled]="!jsonOutput">
          <mat-icon>download</mat-icon>
          Download
        </button>
      </div>
      <div class="output-container">
        <!-- Error State -->
        @if (error) {
          <div class="error-message">
            <mat-icon>error_outline</mat-icon>
            <span>{{ error }}</span>
          </div>
        }

        <!-- Tree View -->
        @if (viewMode === 'tree') {
          <app-json-tree-view [json]="parsedOutput" class="tree-view"></app-json-tree-view>
        }
        
        <!-- JSON Viewer -->
        @else if (viewMode === 'viewer') {
          <div class="json-viewer-container">
            <app-json-viewer [json]="parsedOutput" [expanded]="true"></app-json-viewer>
          </div>
        }

        <!-- Converted Output (XML/YAML/CSV) -->
        @else if (convertedOutput) {
          <div class="output-wrapper">

            
            @if (conversionError) {
              <div class="error-message">
                <mat-icon>error_outline</mat-icon>
                <span>{{ conversionError }}</span>
              </div>
            }

            <div class="output-content">
              @if (currentFormat === 'csv') {
                <pre class="csv-output">{{ convertedOutput }}</pre>
              } @else {
                <pre class="language-{{ currentFormat }}">
                  <code class="language-{{ currentFormat }}">{{ convertedOutput }}</code>
                </pre>
              }
            </div>
          </div>
        }

        <!-- JSON Output -->
        @else if (jsonOutput) {
          <div class="output-wrapper">
            <div class="output-content" [class.minified-container]="isMinified">
              @if (isMinified) {
                <pre class="minified-json">{{ jsonOutput }}</pre>
              } @else {
                <pre class="language-json"><code class="language-json">{{ jsonOutput }}</code></pre>
              }
            </div>
          </div>
        }



        <!-- Empty State -->
        @else {
          <div class="empty-state">
            <mat-icon>code_off</mat-icon>
            <p>Formatted JSON will appear here...</p>
          </div>
        }
      </div>
    </div>
  </div>
</div>
